version: 1
backend:
  phases:
    preBuild:
      commands:
        - echo "Installing Python dependencies..."
        - pip3 install -r requirements.txt
        - echo "Setting up database..."
        - python3 create_db.py
    build:
      commands:
        - echo "Backend setup completed"
  artifacts:
    baseDirectory: .
    files:
      - journal/**/*
      - instance/**/*
      - wsgi_production.py
      - requirements.txt
frontend:
  phases:
    preBuild:
      commands:
        - npm ci
        - echo "Building with timestamp $(date)"
    build:
      commands:
        - npm run build
        - echo "Build completed at $(date)"
  artifacts:
    baseDirectory: dist
    files:
      - '**/*'
  cache:
    paths: []
  environment:
    variables:
      VITE_API_URL: /api
      NODE_ENV: production
